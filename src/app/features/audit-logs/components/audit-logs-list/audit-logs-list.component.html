<div class="audit-logs">
  <h2>Audit Logs</h2>

  <div *ngIf="!selectedModule" class="module-grid">
    <button class="module-card" *ngFor="let m of visibleModules()" (click)="selectModule(m.key)">
      <i *ngIf="m.icon" [class]="m.icon"></i>
      <span>{{ m.label }}</span>
    </button>
  </div>

  <div *ngIf="selectedModule" class="filters">
    <button class="back" (click)="clearModule()">← All Modules</button>
    <h3 style="margin:0 12px 0 0;">{{ selectedModule | titlecase }} Logs</h3>
    <label>
      Action:
      <select [(ngModel)]="action" (ngModelChange)="onFiltersChange()">
        <option value="">All</option>
        <option value="create">Create</option>
        <option value="update">Update</option>
        <option value="delete">Delete</option>
      </select>
    </label>
  </div>

  <table class="table" *ngIf="selectedModule">
    <thead>
      <tr>
        <th>When</th>
        <th>Module</th>
        <th>Action</th>
        <th>Entity</th>
        <th>By</th>
        <th>Changes</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let log of logs">
        <td>{{ log.createdAt | date:'short' }}</td>
        <td>{{ log.module }}</td>
        <td>{{ log.action }}</td>
        <td>{{ log.entityType }} {{ log.entityId }}</td>
        <td>{{ log.performedByEmail || log.performedBy }}</td>
        <td>
          <div *ngFor="let c of log.changes">
            <strong>{{ c.field }}:</strong>
            <span *ngIf="c.oldValue !== undefined">{{ c.oldValue | json }} → </span>
            <span>{{ c.newValue | json }}</span>
          </div>
        </td>
      </tr>
    </tbody>
  </table>

  <div class="pagination" *ngIf="selectedModule && total > limit">
    <button (click)="page = page - 1; fetch()" [disabled]="page <= 1">Prev</button>
    <span>Page {{ page }} of {{ totalPages }}</span>
    <button (click)="page = page + 1; fetch()" [disabled]="page >= totalPages">Next</button>
  </div>
</div>


