<div class="user-list-container">
  <div class="header">
    <h1>Users</h1>
    <div class="header-actions">
      <button class="btn-refresh" (click)="refreshUsers()" title="Refresh">
        <i class="fas fa-sync-alt"></i>
      </button>
      <button class="btn-add" (click)="openAddUserModal()">
        <i class="fas fa-plus"></i>
        Add New User
      </button>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>

  <div class="filters">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input
        type="text"
        placeholder="Search users..."
        [value]="searchTerm"
        (input)="onSearchChange($event)">
    </div>

    <div class="filter-buttons">
      <button
        class="btn-filter"
        [class.active]="statusFilter === 'all'"
        (click)="onStatusFilterChange('all')">
        All
      </button>
      <button
        class="btn-filter"
        [class.active]="statusFilter === 'active'"
        (click)="onStatusFilterChange('active')">
        Active
      </button>
      <button
        class="btn-filter"
        [class.active]="statusFilter === 'inactive'"
        (click)="onStatusFilterChange('inactive')">
        Inactive
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading users...</p>
  </div>

  <!-- Users Table -->
  <div *ngIf="!loading && users.length > 0" class="users-table">
    <table>
      <thead>
        <tr>
          <th (click)="onSort('firstname')" class="sortable">
            User
            <i class="fas fa-sort" *ngIf="sortBy !== 'firstname'"></i>
            <i class="fas fa-sort-up" *ngIf="sortBy === 'firstname' && sortOrder === 'asc'"></i>
            <i class="fas fa-sort-down" *ngIf="sortBy === 'firstname' && sortOrder === 'desc'"></i>
          </th>
          <th (click)="onSort('email')" class="sortable">
            Email
            <i class="fas fa-sort" *ngIf="sortBy !== 'email'"></i>
            <i class="fas fa-sort-up" *ngIf="sortBy === 'email' && sortOrder === 'asc'"></i>
            <i class="fas fa-sort-down" *ngIf="sortBy === 'email' && sortOrder === 'desc'"></i>
          </th>
          <th>Role</th>
          <th>Mobile</th>
          <th>Center</th>
          <th (click)="onSort('createdAt')" class="sortable">
            Created Date
            <i class="fas fa-sort" *ngIf="sortBy !== 'createdAt'"></i>
            <i class="fas fa-sort-up" *ngIf="sortBy === 'createdAt' && sortOrder === 'asc'"></i>
            <i class="fas fa-sort-down" *ngIf="sortBy === 'createdAt' && sortOrder === 'desc'"></i>
          </th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of users">
          <td class="user-cell">
            <img [src]="getProfileImage(user)" [alt]="getFullName(user)" class="user-avatar">
            <span class="user-name">{{ getFullName(user) }}</span>
          </td>
          <td>{{ user.email }}</td>
          <td>{{ user.role || 'No Role' }}</td>
          <td>{{ user.mobilenumber }}</td>
          <td>{{ user.center }}</td>
          <td>{{ user.createdAt | date:'shortDate' }}</td>
          <td>
            <span class="status-badge" [ngClass]="getStatusClass(user.isActive)">
              {{ getStatusText(user.isActive) }}
            </span>
          </td>
          <td class="actions">
            <button class="btn-icon" title="View Details" (click)="viewUserDetails(user._id)">
              <i class="fas fa-eye"></i>
            </button>
            <button class="btn-icon" title="Edit" (click)="openEditUserModal(user)">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn-icon delete" title="Delete" (click)="openDeleteUserModal(user)">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && users.length === 0" class="empty-state">
    <i class="fas fa-users"></i>
    <p>No users found</p>
  </div>

  <!-- Pagination -->
  <div *ngIf="!loading && totalPages > 1" class="pagination">
    <button
      class="btn-page"
      [disabled]="currentPage === 1"
      (click)="onPageChange(currentPage - 1)">
      <i class="fas fa-chevron-left"></i>
    </button>

    <button
      *ngFor="let page of pages"
      class="btn-page"
      [class.active]="page === currentPage"
      (click)="onPageChange(page)">
      {{ page }}
    </button>

    <button
      class="btn-page"
      [disabled]="currentPage === totalPages"
      (click)="onPageChange(currentPage + 1)">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>

  <!-- User Form Modal -->
  <app-user-form-modal
    [isOpen]="showUserModal"
    [user]="selectedUser"
    (closeModal)="closeUserModal()"
    (userSaved)="onUserSaved($event)">
  </app-user-form-modal>

  <!-- Delete Confirmation Modal -->
  <app-confirm-modal
    [isOpen]="showDeleteModal"
    title="Delete User"
    [message]="'Are you sure you want to delete ' + (selectedUser ? getFullName(selectedUser) : '') + '? This action cannot be undone.'"
    confirmText="Delete User"
    cancelText="Cancel"
    confirmButtonClass="btn-danger"
    [loading]="deleteLoading"
    (confirm)="onDeleteConfirm()"
    (cancel)="closeDeleteModal()">
  </app-confirm-modal>

</div>
