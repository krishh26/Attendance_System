<div class="holiday-management-container">
  <!-- Summary Cards -->
  <div class="summary-cards">
    <div class="summary-card">
      <div class="card-icon">
        <i class="fas fa-calendar-day"></i>
      </div>
      <div class="card-content">
        <h3>Total Holidays</h3>
        <p>{{ summaryStats.totalHolidays }}</p>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-icon active">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="card-content">
        <h3>Active Holidays</h3>
        <p>{{ summaryStats.activeHolidays }}</p>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-icon upcoming">
        <i class="fas fa-calendar-check"></i>
      </div>
      <div class="card-content">
        <h3>Upcoming</h3>
        <p>{{ summaryStats.upcomingHolidays }}</p>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-icon optional">
        <i class="fas fa-calendar-plus"></i>
      </div>
      <div class="card-content">
        <h3>Optional</h3>
        <p>{{ summaryStats.optionalHolidays }}</p>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="content-section">
    <div class="header">
      <h1>Holiday Management</h1>
      <button class="btn-add" (click)="showAddHolidayForm()">
        <i class="fas fa-plus"></i>
        Add Holiday
      </button>
    </div>

    <!-- Enhanced Filters -->
    <div class="filters-container">
      <div class="filters-header">
        <h3 class="filters-title">
          <i class="fas fa-filter"></i>
          Filters & Search
        </h3>
        <button
          class="btn-clear-filters"
          (click)="clearAllFilters()"
          [disabled]="!hasActiveFilters()">
          <i class="fas fa-times"></i>
          Clear All
        </button>
      </div>

      <div class="filters-content">
        <!-- Search Section -->
        <div class="filter-section">
          <label class="filter-label">
            <i class="fas fa-search"></i>
            Search Holidays
          </label>
          <div class="search-container">
            <input
              type="text"
              placeholder="Type holiday name or description..."
              [(ngModel)]="searchTerm"
              (input)="onSearch()"
              class="search-input">
            <button
              class="btn-clear-search"
              (click)="clearSearch()"
              *ngIf="searchTerm"
              title="Clear search">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>

        <!-- Year Filter Section -->
        <div class="filter-section">
          <label class="filter-label">
            <i class="fas fa-calendar-alt"></i>
            Select Year
          </label>
          <div class="year-container">
            <select
              [(ngModel)]="yearFilter"
              (change)="onYearChange()"
              class="year-select">
              <option *ngFor="let year of getYearOptions()" [value]="year">{{ year }}</option>
            </select>
            <button
              class="btn-current-year"
              (click)="setCurrentYear()"
              title="Set to current year">
              <i class="fas fa-calendar-day"></i>
              Current
            </button>
          </div>
        </div>

        <!-- Status Filter Section -->
        <div class="filter-section">
          <label class="filter-label">
            <i class="fas fa-toggle-on"></i>
            Filter by Status
          </label>
          <div class="status-filters">
            <button
              class="status-chip"
              [class.active]="statusFilter === 'all'"
              (click)="onStatusFilterChange('all')">
              <i class="fas fa-list"></i>
              <span>All</span>
              <span class="count" *ngIf="summaryStats.totalHolidays > 0">{{ summaryStats.totalHolidays }}</span>
            </button>
            <button
              class="status-chip active"
              [class.active]="statusFilter === 'active'"
              (click)="onStatusFilterChange('active')">
              <i class="fas fa-check-circle"></i>
              <span>Active</span>
              <span class="count" *ngIf="summaryStats.activeHolidays > 0">{{ summaryStats.activeHolidays }}</span>
            </button>
            <button
              class="status-chip inactive"
              [class.active]="statusFilter === 'inactive'"
              (click)="onStatusFilterChange('inactive')">
              <i class="fas fa-times-circle"></i>
              <span>Inactive</span>
              <span class="count" *ngIf="(summaryStats.totalHolidays - summaryStats.activeHolidays) > 0">{{ summaryStats.totalHolidays - summaryStats.activeHolidays }}</span>
            </button>
          </div>
        </div>
      </div>
    </div>

  <!-- Error Display -->
  <div *ngIf="error" class="alert alert-danger">
    <i class="fas fa-exclamation-triangle"></i> {{ error }}
    <button type="button" class="btn-close" (click)="error = null">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <!-- Success Display -->
  <div *ngIf="successMessage" class="alert alert-success">
    <i class="fas fa-check-circle"></i> {{ successMessage }}
    <button type="button" class="btn-close" (click)="successMessage = null">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading holidays...</p>
  </div>

  <!-- Holidays Table -->
  <div *ngIf="!loading" class="table-container">
    <!-- Summary -->
    <div *ngIf="holidays.length > 0" class="summary-section">
      <p class="summary-text">
        Showing {{ filteredHolidays.length }} of {{ holidays.length }} holidays
        <span *ngIf="filteredHolidays.length !== holidays.length" class="filtered-indicator">
          (filtered)
        </span>
      </p>
    </div>

    <div *ngIf="filteredHolidays.length === 0" class="no-data">
      <i class="fas fa-calendar-times"></i>
      <h3 *ngIf="holidays.length === 0">No holidays found</h3>
      <h3 *ngIf="holidays.length > 0">No holidays match your filters</h3>
      <p *ngIf="holidays.length === 0">No holidays have been added yet. Add your first holiday to get started.</p>
      <p *ngIf="holidays.length > 0">No holidays match your current filters. Try adjusting your search criteria.</p>
    </div>

    <table *ngIf="filteredHolidays.length > 0" class="holidays-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Date</th>
          <th>Description</th>
          <!-- <th>Type</th> -->
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let holiday of filteredHolidays" class="holiday-row">
          <td class="holiday-name">{{ holiday.name }}</td>
          <td class="holiday-date">{{ formatDate(holiday.date) }}</td>
          <td class="holiday-description">{{ holiday.description }}</td>
          <!-- <td class="holiday-type">
            <span class="badge" [class]="holiday.isOptional ? 'badge-warning' : 'badge-primary'">
              {{ holiday.isOptional ? 'Optional' : 'Mandatory' }}
            </span>
          </td> -->
          <td class="holiday-status">
            <span class="badge" [class]="holiday.isActive ? 'badge-success' : 'badge-secondary'">
              {{ holiday.isActive ? 'Active' : 'Inactive' }}
            </span>
          </td>
          <td class="holiday-actions">
            <button
              class="btn btn-sm btn-outline-primary"
              (click)="showEditHolidayForm(holiday)"
              title="Edit Holiday"
            >
              <i class="fas fa-edit"></i>
            </button>
            <button
              class="btn btn-sm btn-outline-success"
              (click)="toggleHolidayStatus(holiday)"
              [title]="holiday.isActive ? 'Deactivate' : 'Activate'"
            >
              <i [class]="holiday.isActive ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
            </button>
            <button
              class="btn btn-sm btn-outline-danger"
              (click)="showDeleteConfirmation(holiday)"
              title="Delete Holiday"
            >
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Add/Edit Form Modal -->
  <div *ngIf="showAddForm || showEditForm" class="modal-overlay" (click)="closeForms()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ showEditForm ? 'Edit Holiday' : 'Add New Holiday' }}</h3>
        <button type="button" class="btn-close" (click)="closeForms()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form (ngSubmit)="onSubmit()" class="holiday-form">
        <div class="form-group">
          <label for="holidayName">Holiday Name *</label>
          <input
            type="text"
            id="holidayName"
            [(ngModel)]="holidayForm.name"
            name="name"
            class="form-control"
            placeholder="Enter holiday name"
            required
          >
        </div>

        <div class="form-group">
          <label for="holidayDate">Date *</label>
          <input
            type="date"
            id="holidayDate"
            [(ngModel)]="holidayForm.date"
            name="date"
            class="form-control"
            required
          >
        </div>

        <div class="form-group">
          <label for="holidayDescription">Description *</label>
          <textarea
            id="holidayDescription"
            [(ngModel)]="holidayForm.description"
            name="description"
            class="form-control"
            rows="3"
            placeholder="Enter holiday description"
            required
          ></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="checkbox-label">
              <input
                type="checkbox"
                [(ngModel)]="holidayForm.isActive"
                name="isActive"
              >
              <span class="checkmark"></span>
              Active
            </label>
          </div>

          <div class="form-group">
            <label class="checkbox-label">
              <input
                type="checkbox"
                [(ngModel)]="holidayForm.isOptional"
                name="isOptional"
              >
              <span class="checkmark"></span>
              Optional Holiday
            </label>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="closeForms()">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="formLoading">
            <span *ngIf="formLoading" class="spinner-small"></span>
            {{ showEditForm ? 'Update' : 'Create' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div *ngIf="showDeleteConfirm" class="modal-overlay" (click)="cancelDelete()">
    <div class="modal-content delete-confirm" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Confirm Delete</h3>
        <button type="button" class="btn-close" (click)="cancelDelete()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <p>Are you sure you want to delete the holiday "<strong>{{ holidayToDelete?.name }}</strong>"?</p>
        <p class="text-muted">This action cannot be undone.</p>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cancelDelete()">
          Cancel
        </button>
        <button type="button" class="btn btn-danger" (click)="confirmDelete()" [disabled]="deleteLoading">
          <span *ngIf="deleteLoading" class="spinner-small"></span>
          Delete
        </button>
      </div>
    </div>
  </div>
</div>
