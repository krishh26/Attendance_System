<div class="leave-list-container">
  <div class="header">
    <h1>Leave Requests</h1>
    <div class="header-actions">
      <button class="btn-refresh" (click)="refreshData()" title="Refresh">
        <i class="fas fa-sync-alt"></i>
      </button>
      <button class="btn-add" (click)="createLeaveRequest()" *ngIf="canCreate()">
        <i class="fas fa-plus"></i>
        New Leave Request
      </button>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>

  <div class="filters">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input
        type="text"
        placeholder="Search leave requests..."
        [value]="searchTerm"
        (input)="onSearchChange($event)">
    </div>

    <div class="filter-buttons">
      <button
        class="btn-filter"
        [class.active]="statusFilter === 'all'"
        (click)="onStatusFilterChange('all')">
        All
      </button>
      <button
        class="btn-filter"
        [class.active]="statusFilter === 'pending'"
        (click)="onStatusFilterChange('pending')">
        Pending
      </button>
      <button
        class="btn-filter"
        [class.active]="statusFilter === 'approved'"
        (click)="onStatusFilterChange('approved')">
        Approved
      </button>
      <button
        class="btn-filter"
        [class.active]="statusFilter === 'rejected'"
        (click)="onStatusFilterChange('rejected')">
        Rejected
      </button>
      <button
        class="btn-filter"
        [class.active]="statusFilter === 'cancelled'"
        (click)="onStatusFilterChange('cancelled')">
        Cancelled
      </button>
    </div>

    <div class="filter-controls">
      <div class="filter-group">
        <label>Leave Type:</label>
        <select [(ngModel)]="leaveTypeFilter" (change)="onLeaveTypeFilterChange()">
          <option value="all">All Types</option>
          <option value="annual">Annual Leave</option>
          <option value="casual">Casual Leave</option>
          <option value="sick">Sick Leave</option>
          <option value="full-day">Full Day</option>
          <option value="half-day">Half Day</option>
          <option value="other">Other</option>
        </select>
      </div>

      <div class="filter-group">
        <label>Half Day:</label>
        <select [(ngModel)]="halfDayFilter" (change)="onHalfDayFilterChange()">
          <option value="all">All</option>
          <option value="true">Half Day</option>
          <option value="false">Full Day</option>
        </select>
      </div>

      <div class="filter-group">
        <label>Start Date:</label>
        <input
          type="date"
          [(ngModel)]="startDateFilter"
          (change)="onDateFilterChange()">
      </div>

      <div class="filter-group">
        <label>End Date:</label>
        <input
          type="date"
          [(ngModel)]="endDateFilter"
          (change)="onDateFilterChange()">
      </div>

      <button class="btn-clear-filters" (click)="clearFilters()">
        <i class="fas fa-times"></i>
        Clear Filters
      </button>
    </div>

  </div>

  <!-- Results meta -->
  <div class="results-meta" *ngIf="!loading && totalItems > 0">
    <span>{{ rangeStart }}â€“{{ rangeEnd }} of {{ totalItems }} leave requests</span>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading leave requests...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-state">
    <i class="fas fa-exclamation-triangle"></i>
    <p>{{ error }}</p>
    <button class="btn-retry" (click)="loadLeaveRequests()">Retry</button>
  </div>

  <!-- Leave Table -->
  <div *ngIf="!loading && leaveRequests.length > 0" class="leave-table">
    <table>
      <thead>
        <tr>
          <th (click)="onSort('employee')" class="sortable">
            Employee
            <i class="fas fa-sort" *ngIf="sortBy !== 'employee'"></i>
            <i class="fas fa-sort-up" *ngIf="sortBy === 'employee' && sortOrder === 'asc'"></i>
            <i class="fas fa-sort-down" *ngIf="sortBy === 'employee' && sortOrder === 'desc'"></i>
          </th>
          <th (click)="onSort('leaveType')" class="sortable">
            Leave Type
            <i class="fas fa-sort" *ngIf="sortBy !== 'leaveType'"></i>
            <i class="fas fa-sort-up" *ngIf="sortBy === 'leaveType' && sortOrder === 'asc'"></i>
            <i class="fas fa-sort-down" *ngIf="sortBy === 'leaveType' && sortOrder === 'desc'"></i>
          </th>
          <th (click)="onSort('startDate')" class="sortable">
            Start Date
            <i class="fas fa-sort" *ngIf="sortBy !== 'startDate'"></i>
            <i class="fas fa-sort-up" *ngIf="sortBy === 'startDate' && sortOrder === 'asc'"></i>
            <i class="fas fa-sort-down" *ngIf="sortBy === 'startDate' && sortOrder === 'desc'"></i>
          </th>
          <th (click)="onSort('endDate')" class="sortable">
            End Date
            <i class="fas fa-sort" *ngIf="sortBy !== 'endDate'"></i>
            <i class="fas fa-sort-up" *ngIf="sortBy === 'endDate' && sortOrder === 'asc'"></i>
            <i class="fas fa-sort-down" *ngIf="sortBy === 'endDate' && sortOrder === 'desc'"></i>
          </th>
          <th>Total Days</th>
          <th (click)="onSort('status')" class="sortable">
            Status
            <i class="fas fa-sort" *ngIf="sortBy !== 'status'"></i>
            <i class="fas fa-sort-up" *ngIf="sortBy === 'status' && sortOrder === 'asc'"></i>
            <i class="fas fa-sort-down" *ngIf="sortBy === 'status' && sortOrder === 'desc'"></i>
          </th>
          <th>Reason</th>
          <th (click)="onSort('createdAt')" class="sortable">
            Created Date
            <i class="fas fa-sort" *ngIf="sortBy !== 'createdAt'"></i>
            <i class="fas fa-sort-up" *ngIf="sortBy === 'createdAt' && sortOrder === 'asc'"></i>
            <i class="fas fa-sort-down" *ngIf="sortBy === 'createdAt' && sortOrder === 'desc'"></i>
          </th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let leave of leaveRequests">
          <td class="employee-cell">
            <img [src]="getProfileImage(leave)" [alt]="getEmployeeName(leave)" class="employee-avatar">
            <span class="employee-name">{{ getEmployeeName(leave) }}</span>
          </td>
          <td>
            <span class="leave-type-badge" [ngClass]="'type-' + leave.leaveType">
              {{ getLeaveTypeText(leave.leaveType) }}
            </span>
            <span *ngIf="leave.isHalfDay" class="half-day-indicator">
              ({{ leave.halfDayType || 'Half Day' }})
            </span>
          </td>
          <td>{{ formatDate(leave.startDate) }}</td>
          <td>{{ formatDate(leave.endDate) }}</td>
          <td>{{ leave.totalDays }} day(s)</td>
          <td>
            <span class="status-badge" [ngClass]="getStatusClass(leave.status)">
              {{ getStatusText(leave.status) }}
            </span>
          </td>
          <td class="reason-cell">
            <span class="reason-text" [title]="leave.reason">{{ leave.reason }}</span>
          </td>
          <td>{{ formatDateTime(leave.createdAt) }}</td>
          <td class="actions">
            <button class="btn-icon view" title="View Details" (click)="viewLeaveDetails(leave._id)">
              <i class="fas fa-eye"></i>
            </button>
            <button
              class="btn-icon edit"
              [title]="canEdit(leave) ? 'Edit this leave request' : 'Only pending requests can be edited'"
              *ngIf="canEdit(leave)"
              (click)="editLeaveRequest(leave)"
              [disabled]="!canEdit(leave)">
              <i class="fas fa-edit"></i>
            </button>
            <button
              class="btn-icon delete"
              [title]="canDelete(leave) ? 'Delete this leave request' : 'Only pending requests can be deleted'"
              *ngIf="canDelete(leave)"
              (click)="deleteLeaveRequest(leave)"
              [disabled]="!canDelete(leave)">
              <i class="fas fa-trash"></i>
            </button>
            <button
              class="btn-icon status"
              title="Update Status"
              (click)="openStatusModal(leave)">
              <i class="fas fa-cog"></i>
            </button>
            <div *ngIf="canApproveReject(leave)" class="approval-actions">
              <button 
                class="btn-icon approve" 
                [title]="leave.status !== 'pending' ? 'Only pending requests can be approved' : 'Approve this leave request'"
                (click)="approveLeaveRequest(leave)"
                [disabled]="leave.status !== 'pending'">
                <i class="fas fa-check"></i>
              </button>
              <button 
                class="btn-icon reject" 
                [title]="leave.status !== 'pending' ? 'Only pending requests can be rejected' : 'Reject this leave request'"
                (click)="rejectLeaveRequest(leave)"
                [disabled]="leave.status !== 'pending'">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && leaveRequests.length === 0" class="empty-state">
    <i class="fas fa-inbox"></i>
    <p>No leave requests found</p>
    <span>Try adjusting your filters or create a new leave request</span>
  </div>

  <!-- Pagination and Rows Selection -->
  <div *ngIf="!loading && totalPages > 1" class="pagination-container">
    <div class="pagination">
      <button
        class="btn-page"
        [disabled]="currentPage === 1"
        (click)="onPageChange(1)"
        title="First">
        <i class="fas fa-angle-double-left"></i>
      </button>
      <button
        class="btn-page"
        [disabled]="currentPage === 1"
        (click)="onPageChange(currentPage - 1)">
        <i class="fas fa-chevron-left"></i>
      </button>

      <button
        *ngFor="let page of pages"
        class="btn-page"
        [class.active]="page === currentPage"
        (click)="onPageChange(page)">
        {{ page }}
      </button>

      <button
        class="btn-page"
        [disabled]="currentPage === totalPages"
        (click)="onPageChange(currentPage + 1)">
        <i class="fas fa-chevron-right"></i>
      </button>
      <button
        class="btn-page"
        [disabled]="currentPage === totalPages"
        (click)="onPageChange(totalPages)"
        title="Last">
        <i class="fas fa-angle-double-right"></i>
      </button>
    </div>

    <div class="rows-selection">
      <label for="pageSize">Rows</label>
      <select id="pageSize" [ngModel]="pageSize" (ngModelChange)="onPageSizeChange($event)">
        <option *ngFor="let size of pageSizeOptions" [ngValue]="size">{{ size }}</option>
      </select>
    </div>
  </div>

  <!-- Status Update Modal -->
  <app-status-update-modal
    [isOpen]="showStatusModal"
    [leaveRequest]="selectedLeaveRequest"
    (closeModal)="closeStatusModal()"
    (statusUpdated)="onStatusUpdated($event)">
  </app-status-update-modal>
</div>
