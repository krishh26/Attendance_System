<div class="timelog-container">
  <!-- Summary Cards -->
  <div class="summary-cards">
    <div class="summary-card">
      <div class="card-icon">
        <i class="fas fa-users"></i>
      </div>
      <div class="card-content">
        <h3>Total Employees</h3>
        <p>{{ summaryStats.totalEmployees }}</p>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-icon present">
        <i class="fas fa-user-check"></i>
      </div>
      <div class="card-content">
        <h3>Present Today</h3>
        <p>{{ summaryStats.presentToday }}</p>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-icon late">
        <i class="fas fa-user-clock"></i>
      </div>
      <div class="card-content">
        <h3>Late Today</h3>
        <p>{{ summaryStats.lateToday }}</p>
      </div>
    </div>

    <div class="summary-card">
      <div class="card-icon absent">
        <i class="fas fa-user-times"></i>
      </div>
      <div class="card-content">
        <h3>Absent Today</h3>
        <p>{{ summaryStats.absentToday }}</p>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="content-section">
    <div class="header">
      <h1>Time Logs</h1>
      <button class="btn-add">
        <i class="fas fa-plus"></i>
        Add Time Entry
      </button>
    </div>

    <!-- Error Message -->
    <div *ngIf="error" class="error-message">
      <i class="fas fa-exclamation-triangle"></i>
      {{ error }}
    </div>

    <!-- Enhanced Filters -->
    <div class="filters-container">
      <div class="filters-header">
        <h3 class="filters-title">
          <i class="fas fa-filter"></i>
          Filters
        </h3>
        <button
          class="btn-clear-filters"
          (click)="clearAllFilters()"
          [disabled]="!hasActiveFilters()">
          <i class="fas fa-times"></i>
          Clear All
        </button>
      </div>

      <div class="filters-content">
        <!-- Search Section -->
        <div class="filter-section">
          <label class="filter-label">
            <i class="fas fa-search"></i>
            Search Employee
          </label>
          <div class="search-container">
            <input
              type="text"
              placeholder="Type employee name or ID..."
              [(ngModel)]="searchTerm"
              (input)="onSearchChange()"
              class="search-input">
            <button
              class="btn-clear-search"
              (click)="clearSearch()"
              *ngIf="searchTerm"
              title="Clear search">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>

        <!-- Date Filter Section -->
        <div class="filter-section">
          <label class="filter-label">
            <i class="fas fa-calendar-alt"></i>
            Select Date
          </label>
          <div class="date-container">
            <input
              type="date"
              id="dateFilter"
              [(ngModel)]="selectedDate"
              (change)="onDateChange()"
              class="date-input">
            <button
              class="btn-today"
              (click)="setToday()"
              title="Set to today">
              <i class="fas fa-calendar-day"></i>
              Today
            </button>
          </div>
        </div>

        <!-- Status Filter Section -->
        <div class="filter-section">
          <label class="filter-label">
            <i class="fas fa-user-check"></i>
            Filter by Status
          </label>
          <div class="status-filters">
            <button
              class="status-chip"
              [class.active]="selectedStatus === 'all'"
              (click)="selectedStatus = 'all'; onStatusChange()">
              <i class="fas fa-users"></i>
              <span>All</span>
              <span class="count" *ngIf="summaryStats.totalEmployees > 0">{{ summaryStats.totalEmployees }}</span>
            </button>
            <button
              class="status-chip present"
              [class.active]="selectedStatus === 'present'"
              (click)="selectedStatus = 'present'; onStatusChange()">
              <i class="fas fa-user-check"></i>
              <span>Present</span>
              <span class="count" *ngIf="summaryStats.presentToday > 0">{{ summaryStats.presentToday }}</span>
            </button>
            <button
              class="status-chip late"
              [class.active]="selectedStatus === 'late'"
              (click)="selectedStatus = 'late'; onStatusChange()">
              <i class="fas fa-user-clock"></i>
              <span>Late</span>
              <span class="count" *ngIf="summaryStats.lateToday > 0">{{ summaryStats.lateToday }}</span>
            </button>
            <button
              class="status-chip absent"
              [class.active]="selectedStatus === 'absent'"
              (click)="selectedStatus = 'absent'; onStatusChange()">
              <i class="fas fa-user-times"></i>
              <span>Absent</span>
              <span class="count" *ngIf="summaryStats.absentToday > 0">{{ summaryStats.absentToday }}</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>Loading time logs...</p>
    </div>

    <!-- Time Entries Table -->
    <div *ngIf="!loading" class="timelog-table">
      <table>
        <thead>
          <tr>
            <th>Employee ID</th>
            <th>Date</th>
            <th>Check In Time</th>
            <th>Check Out Time</th>
            <th>Total Hours</th>
            <th>Status</th>
            <th>Check In Location</th>
            <th>Check Out Location</th>
            <!-- <th>Session</th> -->
            <!-- <th>Actions</th> -->
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let entry of filteredTimeEntries">
            <td>{{ getEmployeeName(entry) }}</td>
            <td>{{ formatDate(entry.date) }}</td>
            <td>{{ formatTime(entry.checkInTime) }}</td>
            <td>
              <span *ngIf="isCheckedOut(entry); else notCheckedOut">
                {{ formatTime(entry.checkOutTime) }}
              </span>
              <ng-template #notCheckedOut>
                <span class="not-checked-out">Not checked out</span>
              </ng-template>
            </td>
            <td>{{ getTotalHours(entry) }}</td>
            <td>
              <span class="status-badge" [ngClass]="getStatusClass(entry.status)">
                {{ getStatusText(entry.status) }}
              </span>
            </td>
            <td>
              <div class="location-cell">
                <span *ngIf="hasValidCoordinates(entry.checkInLatitude, entry.checkInLongitude); else noLocationCheckIn">
                  <i class="fas fa-map-marker-alt location-icon"
                     (click)="openMapWithCoordinates(entry.checkInLatitude, entry.checkInLongitude, 'checkin')"
                     title="Click to view on map">
                  </i>
                  <span class="coordinates">{{ entry.checkInLatitude | number:'1.4-4' }}, {{ entry.checkInLongitude | number:'1.4-4' }}</span>
                </span>
                <ng-template #noLocationCheckIn>
                  <span class="no-location">No location data</span>
                </ng-template>
              </div>
            </td>
            <td>
              <div class="location-cell">
                <span *ngIf="hasValidCoordinates(entry.checkOutLatitude, entry.checkOutLongitude); else noLocationCheckOut">
                  <i class="fas fa-map-marker-alt location-icon"
                     (click)="openMapWithCoordinates(entry.checkOutLatitude, entry.checkOutLongitude, 'checkout')"
                     title="Click to view on map">
                  </i>
                  <span class="coordinates">{{ entry.checkOutLatitude | number:'1.4-4' }}, {{ entry.checkOutLongitude | number:'1.4-4' }}</span>
                </span>
                <ng-template #noLocationCheckOut>
                  <span class="no-location">No location data</span>
                </ng-template>
              </div>
            </td>
            <!-- <td>{{ entry.sessionNumber }}</td> -->
            <!-- <td class="actions">
              <button class="btn-icon" title="Edit" [disabled]="!isCheckedOut(entry)">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn-icon" title="View Details">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn-icon delete" title="Delete">
                <i class="fas fa-trash"></i>
              </button>
            </td> -->
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && filteredTimeEntries.length === 0" class="empty-state">
      <i class="fas fa-inbox"></i>
      <p>No time logs found</p>
      <span>Try adjusting your filters or select a different date</span>
    </div>

    <!-- Pagination -->
    <div *ngIf="totalPages > 1 && !loading" class="pagination">
      <button
        class="btn-page"
        [disabled]="currentPage === 1"
        (click)="onPageChange(currentPage - 1)">
        <i class="fas fa-chevron-left"></i>
      </button>

      <button
        *ngFor="let page of pages"
        class="btn-page"
        [class.active]="page === currentPage"
        (click)="onPageChange(page)">
        {{ page }}
      </button>

      <button
        class="btn-page"
        [disabled]="currentPage === totalPages"
        (click)="onPageChange(currentPage + 1)">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>

    <!-- Pagination Info -->
    <div *ngIf="totalItems > 0" class="pagination-info">
      Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to {{ Math.min(currentPage * itemsPerPage, totalItems) }} of {{ totalItems }} entries
    </div>
  </div>
</div>
